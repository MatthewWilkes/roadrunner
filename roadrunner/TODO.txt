TODO
====

- ConfigurationError: ('Unknown directive', u'http://namespaces.zope.org/five', u'registerPackage')

Use Products.Five.testbrowser in Plone instead of 

- !!! remove testrunner code and monkey patch instead

- saved time not working anymore !

- Restart the whole shebang if something preloaded changes:
  https://bugs.launchpad.net/grok/+bug/213269
  
Could try using plone.reload first, then if that doesn't work then it could reload everything.

First need a way to detect changes, plone.reload already has that.

It should detect both ZCML and python code changes and trigger the appropriate
plone.reload function.

basically scan the 

- ability to preload any arbitrary layers, plus some presets like --plone or
  --grok

- or better still, the ability to determine which layers should be preloaded
  based on the tests being run?

- ability to run in testloop mode. Basically it will run in a loop and wait
  for changes to be made to the project. After 15 seconds a new test run will
  be made with the current parameters.

- hooks for fixture configuration?

- prevent layer destruction for an added half second (not necessary)

- Find a way to potentially reload all dependencies. Perhaps we could create
  process snapshots at various points along the initialization process and
  then use the most relevant one to build on top of.

- Or barring that a way to detect when things change and notify the user. Make
  it easy to restart the test process.

- We could fork at various points in the init process. Each fork could be
  registered by name so we could resume from any particular point we want
  using a simple API to script the children.

- Forks should not take up a lot of space but basically would be event
  reactors holding copy on write memory.

For example you could store one fork for just before the Plone core init but
after the main Zope init.

something like:

process.restore('zope:after', next_action='plone')
\
Zope appserver support:

- What would be really cool is to preload Zope & Plone component and then fork
  right before loading your specific products. might require some nasty zope
  hacks.